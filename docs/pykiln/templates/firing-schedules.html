<!doctype html>
<html lang="en" class="h-100">
{% with title="Firing Schedules" %}
{% include 'head.html' %}
{% endwith %}

<body class="d-flex flex-column h-100">
  {% include 'nav.html' %}

  <main role="main" class="flex-shrink-0">
    <div class="container">

        <div class="row">
          <div class="col-12">
            <h2>Edit Firing Schedule:</h2>
            <select class="custom-select" id="fireScheduleList" name="fireScheduleList">
              <option selected>Select Schedule</option>
            </select>
          </div>
        </div>

        

        <!--add rows and delete firing schedule-->
        <div class="row mt-3">
          <div class="col-md-12">
            <button id="btn-create-schedule" class="btn btn-primary btn-responsive mb-2"><i class="fas fa-file-alt"></i> New Schedule</button>
            <!-- TO DO: Add the ability to Duplicate existing schedules -->
            <button id="btn-duplicate-schedule" class="btn btn-light btn-responsive mb-2"><i class="fas fa-copy"></i><span class="d-none d-sm-inline"> Duplicate</span></button>
            <button id="btn-import-schedule" class="btn btn-light btn-responsive mb-2"><i class="fas fa-file-upload"></i><span class="d-none d-sm-inline"> Import</span></button>
            <button id="btn-download-schedule" class="btn btn-light btn-responsive mb-2"><i class="fas fa-file-download"></i><span class="d-none d-sm-inline"> Export</span></button>
            

            <form id="importForm" enctype="multipart/form-data" class="d-none">
              <input type="file" accept=".json" id="import-schedule" name="imported-schedule">
              <input type="submit" name="submit">
            </form>

          </div>
        </div>

        <script>
            importForm.onsubmit = async (e) => {
              e.preventDefault();
          
              let response = await fetch('/api/import-schedule', {
                method: 'POST',
                body: new FormData(importForm)
              });
          
              let result = await response.json();
              location.reload();
              //alert(result.message);
            };
          </script>

      <div id="schedule-group" class="d-none">

      <h2 class="mb-3 mt-3" contenteditable="true" id="schedule-title">Bisque Fire (Stoneware)</h2>

      <h5>Firing Schedule</h5>
      <div id="table" class="table-responsive table-editable">
        <table class="table table-striped table-sm schedule">
          <thead>
            <tr class="schedule-header">
              <th>SEG #</th>
              <th class="degrees">RATE<br>(°C/HOUR)</th>
              <th class="degrees">TARGET<br>TEMP (°C)</th>
              <th>HOLD TIME<br>(MINUTES)</th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody id="schedule-body">
            <!--firing segments loaded here-->
          </tbody>
        </table>
      </div>

       <!--cost estimates-->
       <ul id="home-estimates" class="list-group col-12 mb-4">
        <li class="list-group-item"><b>Estimated Time:</b> <span id="home-time">1:00</span></li>
        <!-- <li class="list-group-item"><b>Estimated Cost:</b> <span id="home-cost">$3.50</span></li> -->
      </ul>

      <!--add rows and delete firing schedule-->
      <div class="mb-4">
      <div class="row mt-4">
      
        <div class="col-12">
        <button id="btn-add-segment" class="btn mb-2 full-width-small btn-success table-add"><i class="fas fa-plus-circle"></i> Add Stage</button>

        <button id="btn-save-schedule" class="btn mb-2 full-width-small btn-primary"><i class="fas fa-save"></i> Save Schedule</button>
      
        <button class="btn mb-2 full-width-small btn-light" data-toggle="collapse" data-target="#coneChart" aria-expanded="false" aria-controls="coneChart"><i class="fas fa-table"></i> Cone Chart</button>

        <button data-toggle="modal" data-target="#delete-confirm-modal" id="btn-delete-schedule-modal" class="btn mb-2 full-width-small btn-danger float-right"><i class="fas fa-trash"></i> Delete Schedule</button>
        </div>
        <div id="alert-container" class="col-12"></div>
      
      </div>

      <!--reference cone temperature chart-->
      <div class="row">
        <div class="collapse col-12" id="coneChart">
          <div class="card card-body">
              {% include 'cone-chart.html' %}
          </div>
        </div>
      </div>
    </div>
      

    </div>
  </main>

  {% include 'footer.html' %}

{% with modalid="delete-confirm-modal", modaltitle="Delete Firing Schedule?", modalbody="", buttonid="btn-delete-schedule", modalbutton="<i class='fas fa-trash'></i> Delete Schedule" %}
{% include 'modal-danger.html' %}
{% endwith %}

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  <script>
    $(document).ready(function() {
        console.log( "document loaded" );
        LoadSchedules();
        CelsiusConeChart();
    });
</script>

</body>

</html>